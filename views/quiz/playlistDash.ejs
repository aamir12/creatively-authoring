<!doctype html>
<html lang="en">
<head>
    <%- include('../parts/allCSS'); %>
    <script src="author_public/PaperDashBoard/js/jquery-3.1.1.min.js" type="text/javascript"></script>
    <script type="text/javascript">
      $(document).ready(function() {
        if (window.location.search.indexOf('msg=dberror') > -1) {
            $('#error_db').slideDown();
            function success_1(){
              $('#error_db').slideUp();
            }
            setTimeout(success_1, 5000);
        } else {
            // alert('track not here');
        }
      });
    </script>
</head>
<body>
  <div class="wrapper">
    <%- include('../parts/leftNavBar'); %>
    <div class="main-panel">
      <%- include('../parts/topNavBarPart1'); %> Playlist
        <!-- <p class="category hidden-xs" style="font-weight:normal">List of all playlists generated by author. </p> -->
      <%- include('../parts/topNavBarPart2'); %>
      <div class="content">
        <div class="container-fluid">    
          <div class="row">
            <div class='col-md-10 col-md-offset-1'> <!-- col-md-10 col-md-offset-1 -->
              <div class="card">
                <div class="card-content">
                  <!--error block for new question json.result.error !-->
                  <div class="alert alert-danger" id="pl_nameexits" style="display:none;">
                      <button type="button" aria-hidden="true" class="close">×</button>
                      <span>Playlist name already exit. Please choose another name for playlist !!!</span>
                  </div>
                  <!--error block for new question json.result.error !-->
                  <div class="alert alert-danger" id="pl_nameblank" style="display:none;">
                    <button type="button" aria-hidden="true" class="close">×</button>
                    <span>Playlist name must be provided !!!</span>
                </div>
                  <!--error block for new question json.result.error !-->
                  <div class="alert alert-danger" id="error_db" style="display:none;">
                      <button type="button" aria-hidden="true" class="close">×</button>
                      <span>ERROR: Some error occures !!!</span>
                  </div>
                   <!--error block for new question json.result.error !-->
                   <div class="alert alert-success" id="pl_itemAdded" style="display:none;">
                    <button type="button" aria-hidden="true" class="close">×</button>
                    <span>Items added successfully !!!</span>
                </div>

                  <%if(msg){%>
                    <div class="alert alert-danger" id="msg" style="display:none;">
                      <button type="button" aria-hidden="true" class="close">×</button>
                      <span><%=msg%></span>
                    </div>
                  <%}%>

                  <div class="card-content">
                    <div class="nav-tabs-navigation">
                      <div class="nav-tabs-wrapper">
                        <ul id="tabs" class="nav nav-tabs" data-tabs="tabs">
                            <li class="active"><a href="#authorPlaylist" data-toggle="tab">My Playlists</a></li>
                            <li><a href="#collbPlaylist" data-toggle="tab">Collaborated Playlists</a></li>
                        </ul>
                      </div>
                  </div>
                  <div id="my-tab-content" class="tab-content ">
                      <div class="tab-pane active" id="authorPlaylist">
                        <div class="toolbar">
                          <!--Here you can write extra buttons/actions for the toolbar-->
                          <button class='btn btn-info btn-fill btn-wd' data-toggle="modal" data-target="#myModalNorm"> <i class="ti-plus"></i> Add new playlist</button>
                    </div>
                    <!-- <div class="row"> -->
                      <!-- <div class="col-md-12"> -->
                        <!-- <div class="table-responsive"> -->
                          <table id="example2" class="table">
                            <thead>
                              <tr>
                                <th data-field="updatedAt" data-sortable="true"> Updated At</th>
                                <th data-field="name" data-sortable="true"> Name</th>
                                <!-- <th id="content" >Content</th> -->
                                <th id="description" >Description</th>
                                <th id="noOfItems" >No. Of Items</th>
                                <th data-field="actions" class="td-actions text-center">Actions</th>
                              </tr>
                            </thead>
                            <tbody>
                             
                              <%
                                for(var i=0,j=0; i<playlistdata.length;i++,j++){
                                var strPlaylist = playlistdata[i];  
                                var strPlaylist11 = playlistCon[j];
                              %>
                              <script type="text/javascript">
                                $(document).ready(function() {
                                    var updatedAt_utc = document.getElementById('updatedAt_utc<%-i%>').value;
                                    var d = new Date(updatedAt_utc);
                                    var time = d.toString().split(" ")[4];
                                    var getDate = d.getDate();
                                    var getMonth = d.getMonth() + 1;
                                    var getFullYear = d.getFullYear();
                                    if(getMonth < 10)
                                    getMonth = "0"+getMonth;
                                    if(getDate < 10)
                                    getDate = "0"+getDate;
                                    var startDate = getFullYear+"-"+getMonth+"-"+getDate;
                                    var updatedAt =  startDate.substring(0, 10) + " " + time;
                                    
                                    if(updatedAt == "NaN-NaN-Na undefined"){
                                      document.getElementById('updatedAt<%-i%>').innerHTML = "";
                                    }else{
                                      document.getElementById('updatedAt<%-i%>').innerHTML = updatedAt;
                                    }
  
                                });
                              </script>
                              <tr>
                                <td id="updatedAt<%-i%>"><input type="hidden" id="updatedAt_utc<%-i%>" name="updatedAt_utc<%-i%>" value="<%-strPlaylist[6]%>"></td>
                                <td><%-strPlaylist[1]%> 
                                <% if(strPlaylist[4] !=null && strPlaylist[4].length>0){%>
                                  <span id="collbIcon" aria-hidden="true" class="fa fa-users text-success" style="font-size:1.3em;"></span>
                                <%}%>
                                </td>
                                <!-- <td>
                                  <%  var ques = new Array();
                                      for(var k=0; k<strPlaylist11.length;k++){
                                        ques.push(strPlaylist11[k].item);
                                      }
                                      var slicearr = ques.slice(0, 8);
                                  %>
                                  <% if(ques.length <= 8){%>
                                    <%-slicearr%>
                                  <% } else{%>
                                    <%-slicearr%> <b>...</b>
                                  <%}%>
                                  
                                </td> -->

                                <%if(strPlaylist[5]){
                                  var descp = strPlaylist[5].slice(0, 50);
                                %>
                                <% if(strPlaylist[5].length <= 50){%>
                                    <td><%-descp%></td>
                                <% } else{%>
                                    <td><%-descp%><b>...</b></td>
                                <%}}else{%>
                                <td><%-strPlaylist[5]%></td>
                                <%}%>

                                <td><%-ques.length%></td>
                                <td>
                                  <div class="table-icons">
                                    <a rel="tooltip" title="Edit" class="btn btn-simple btn-warning btn-icon table-action edit" href="/author_getPlaylistData?id=<%-strPlaylist[2]%>" title="Edit" data-original-title="Edit" rel="tooltip"><i class="ti-pencil-alt"></i></a>
                                  </div>
                                </td>
                              </tr>
                              <%}%>  
                            </tbody>
                          </table>
                      </div>
                      <div class="tab-pane" id="collbPlaylist">
                          <!-- <h4 style="color:#66615b">List Of Collaborated Playlist
                              <button type="button" data-toggle="popover" class="btn btn-info btn-simple btn-xs" data-content="">
                                  <i class="ti-help-alt fa-lg"></i>
                              </button>
                          </h4> -->
                        <div class="toolbar1">
                              
                        </div>
                        <!-- <div class="row"> -->
                          <!-- <div class="col-md-12"> -->
                            <!-- <div class="table-responsive"> -->
                              <table id="collbListTbl" class="table">
                                <thead>
                                  <tr>
                                    <th data-field="updatedAt" data-sortable="true"> Updated At</th>
                                    <th data-field="name" data-sortable="true"> Name</th>
                                    <!-- <th id="content" >Content</th> -->
                                    <th id="description" >Description</th>
                                    <th id="noOfItems" >No. Of Items</th>
                                    <th data-field="actions" class="td-actions text-center">Actions</th>
                                  </tr>
                                </thead>
                                <tbody>
                                 
                                  <%
                                    for(var i=0,j=0; i<collb1.length;i++,j++){
                                      var strcollb1 = collb1[i];
                                      var collitm1 = new Array();
                                      strcollb1[0].forEach(function (cont) {
                                        collitm1.push(cont.item);
                                      })
                                  %>
                                  <script type="text/javascript">
                                    $(document).ready(function() {
                                        var updatedAt_utcollb1 = document.getElementById('updatedAt_utcollb1<%-i%>').value;
                                        var d = new Date(updatedAt_utcollb1);
                                        var time = d.toString().split(" ")[4];
                                        var getDate = d.getDate();
                                        var getMonth = d.getMonth() + 1;
                                        var getFullYear = d.getFullYear();
                                        if(getMonth < 10)
                                        getMonth = "0"+getMonth;
                                        if(getDate < 10)
                                        getDate = "0"+getDate;
                                        var startDate = getFullYear+"-"+getMonth+"-"+getDate;
                                        var updatedAt =  startDate.substring(0, 10) + " " + time;
                                        
                                        if(updatedAt == "NaN-NaN-Na undefined"){
                                          document.getElementById('updatedAtcollb1<%-i%>').innerHTML = updatedAt;
                                        }else{
                                          document.getElementById('updatedAtcollb1<%-i%>').innerHTML = updatedAt;
                                        }
      
                                    });
                                  </script>
                                  <tr>
                                    <td id="updatedAtcollb1<%-i%>"><input type="hidden" id="updatedAt_utcollb1<%-i%>" name="updatedAt_utcollb1<%-i%>" value="<%-strcollb1[6]%>"></td>
                                    <td><%-strcollb1[1]%> 
                                    <% if(strcollb1[4] !=null && strcollb1[4].length>0){%>
                                      <span id="collbIcon" aria-hidden="true" class="fa fa-users text-success" style="font-size:1.3em;"></span>
                                    <%}%>
                                    </td>
                                    <!-- <td>
                                      <%  
                                          var slicearr = collitm1.slice(0, 8);
                                      %>
                                      <% if(collitm1.length <= 8){%>
                                        <%-slicearr%>
                                      <% } else{%>
                                        <%-slicearr%> <b>...</b>
                                      <%}%>
                                      
                                    </td> -->

                                    <%if(strcollb1[5]){
                                      var descp1 = strcollb1[5].slice(0, 50);
                                    %>
                                    <% if(strcollb1[5].length <= 50){%>
                                        <td><%-descp1%></td>
                                    <% } else{%>
                                        <td><%-descp1%><b>...</b></td>
                                    <%}}else{%>
                                    <td><%-strcollb1[5]%></td>
                                    <%}%>

                                    <td><%-collitm1.length%></td>
                                    <td>
                                      <div class="table-icons">
                                        <a rel="tooltip" title="Edit" class="btn btn-simple btn-warning btn-icon table-action edit" href="author_getPlaylistData?id=<%-strcollb1[2]%>" title="Edit" data-original-title="Edit" rel="tooltip"><i class="ti-pencil-alt"></i></a>
                                      </div>
                                    </td>
                                  </tr>
                                  <%}%>  
                                  <!-- collab 2 data -->
                                  <%
                                    for(var i=0,j=0; i<collb2.length;i++,j++){
                                      var strcollb2 = collb2[i];
                                      var collitm2 = new Array();
                                      strcollb2[0].forEach(function (cont) {
                                        collitm2.push(cont.item);
                                      })
                                  %>
                                  <script type="text/javascript">
                                    $(document).ready(function() {
                                        var updatedAt_utcCollb2 = document.getElementById('updatedAt_utcCollb2<%-i%>').value;
                                        var d = new Date(updatedAt_utcCollb2);
                                        var time = d.toString().split(" ")[4];
                                        var getDate = d.getDate();
                                        var getMonth = d.getMonth() + 1;
                                        var getFullYear = d.getFullYear();
                                        if(getMonth < 10)
                                        getMonth = "0"+getMonth;
                                        if(getDate < 10)
                                        getDate = "0"+getDate;
                                        var startDate = getFullYear+"-"+getMonth+"-"+getDate;
                                        var updatedAt =  startDate.substring(0, 10) + " " + time;
                                        
                                        if(updatedAt == "NaN-NaN-Na undefined"){
                                          document.getElementById('updatedAtCollb2<%-i%>').innerHTML = updatedAt;
                                        }else{
                                          document.getElementById('updatedAtCollb2<%-i%>').innerHTML = updatedAt;
                                        }
      
                                    });
                                  </script>
                                  <tr>
                                    <td id="updatedAtCollb2<%-i%>"><input type="hidden" id="updatedAt_utcCollb2<%-i%>" name="updatedAt_utcCollb2<%-i%>" value="<%-strcollb2[6]%>"></td>
                                    <td><%-strcollb2[1]%> 
                                    <% if(strcollb2[4] !=null && strcollb2[4].length>0){%>
                                      <span id="collbIcon" aria-hidden="true" class="fa fa-users text-success" style="font-size:1.3em;"></span>
                                    <%}%>
                                    </td>
                                    <!-- <td>
                                      <% 
                                          var slicearr = collitm2.slice(0, 8);
                                      %>
                                      <% if(collitm2.length <= 8){%>
                                        <%-slicearr%>
                                      <% } else{%>
                                        <%-slicearr%> <b>...</b>
                                      <%}%>
                                      
                                    </td> -->

                                    <%if(strcollb2[5]){
                                      var descp2 = strcollb2[5].slice(0, 50);
                                    %>
                                    <% if(strcollb2[5].length <= 50){%>
                                        <td><%-descp2%></td>
                                    <% } else{%>
                                        <td><%-descp2%><b>...</b></td>
                                    <%}}else{%>
                                    <td><%-strcollb2[5]%></td>
                                    <%}%>

                                    <td><%-collitm2.length%></td>
                                    <td>
                                      <div class="table-icons">
                                        <a rel="tooltip" title="Edit" class="btn btn-simple btn-warning btn-icon table-action edit" href="author_getPlaylistData?id=<%-strcollb2[2]%>" title="Edit" data-original-title="Edit" rel="tooltip"><i class="ti-pencil-alt"></i></a>
                                      </div>
                                    </td>
                                  </tr>
                                  <%}%>  
                                </tbody>
                              </table>
                      </div>
                    </div>
                  </div>


                  
                </div> <!-- card-content -->
              </div>
            </div>
          </div><!--  row2 -->
        </div>   <!-- containerfluid -->
      </div><!--  content -->
      <%- include('../parts/footer'); %>
    </div> <!-- main panel -->
  </div> <!-- wrapper -->

  <!-- Modal to add new playlist-->
      <div class="modal fade" id="myModalNorm" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <!-- Modal Header -->
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal">
                <span aria-hidden="true">&times;</span>
                <span class="sr-only">Close</span>
              </button>
              <h4 class="modal-title" id="myModalLabel"><b>Add new playlist</b></h4>
            </div>
            <!-- Modal Body -->
            <div class="modal-body">
              <form role="form" name="add_form" id="add_form" method="post" action="/author_addPlaylist" enctype="multipart/form-data">
                <div class="form-group">
                  <label for="playlist_name">Playlist Name</label>
                  <span class="glyphicon glyphicon-question-sign" data-toggle="tooltip" data-placement="right"  title=""></span>
                  <input type="text" class="form-control" id="playlist_name" name="playlist_name" maxlength="50" required/>
                </div>
                  <input type="hidden" name="author" value="<%-short%>">
                  <div class="clearfix">
                    <button type='submit' class="btn btn-primary btn-fill pull-right" id="add_playlist1" disabled>Add</button>
                  </div>
              </form>  
            </div>
            <!-- Modal Footer -->
            <!-- <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div> -->
          </div>
        </div>
      </div>
</body>
<%- include('../parts/allJS'); %>
<script type="text/javascript" src="author_public/js/author_playlist.js"></script>
<script type="text/javascript">
  
/*platlist dashboard*/
  var $table1 = $('#example2');
  $().ready(function(){
    $table1.bootstrapTable({
        toolbar: ".toolbar",
        clickToSelect: true,
        showRefresh: false,
        search: true,
        showToggle: true,
        showColumns: true,
        pagination: true,
        searchAlign: 'right',
        strictSearch: false,
        pageSize: 10,
        clickToSelect: false,
        pageList: [5, 10, 25, 50, 100],
        sortName:"updatedAt",
        sortOrder :"desc",
        
        
        formatShowingRows: function(pageFrom, pageTo, totalRows){
            //do nothing here, we don't want to show the text "showing x of y from..."
            return "showing "+pageFrom+" to "+pageTo+" of " + totalRows +" entries <br/>";
        },
        formatRecordsPerPage: function(pageNumber){
            return "  "+pageNumber + " rows visible";
        },
        icons: {
            refresh: 'fa fa-refresh',
            toggle: 'fa fa-th-list',
            columns: 'fa fa-columns',
            detailOpen: 'fa fa-plus-circle',
            detailClose: 'ti-close'
        }
    });
    //activate the tooltips after the data table is initialized
    $('[rel="tooltip"]').tooltip();
  });
  $(function() {
     $('#example2').on('post-body.bs.table', function () {
         $('[rel="tooltip"]').tooltip();
     });
  });


  var $table2 = $('#collbListTbl');
  $().ready(function(){
    $table2.bootstrapTable({
        toolbar: ".toolbar1",
        clickToSelect: true,
        showRefresh: false,
        search: true,
        showToggle: true,
        showColumns: true,
        pagination: true,
        searchAlign: 'right',
        strictSearch: false,
        pageSize: 10,
        clickToSelect: false,
        pageList: [5, 10, 25, 50, 100],
        sortName:"updatedAt",
        sortOrder :"desc", 
        
        formatShowingRows: function(pageFrom, pageTo, totalRows){
            //do nothing here, we don't want to show the text "showing x of y from..."
            return "showing "+pageFrom+" to "+pageTo+" of " + totalRows +" entries <br/>";
        },
        formatRecordsPerPage: function(pageNumber){
            return "  "+pageNumber + " rows visible";
        },
        icons: {
            refresh: 'fa fa-refresh',
            toggle: 'fa fa-th-list',
            columns: 'fa fa-columns',
            detailOpen: 'fa fa-plus-circle',
            detailClose: 'ti-close'
        }
    });
    //activate the tooltips after the data table is initialized
    $('[rel="tooltip"]').tooltip();
  });
  $(function() {
     $('#collbListTbl').on('post-body.bs.table', function () {
         $('[rel="tooltip"]').tooltip();
     });
  });
  
</script>
</html>